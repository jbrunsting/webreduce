{% extends "base.html" %}

{% block content %}
<h1>Feed</h1>
<p><a href="/feed/search">Find new plugin</a></p>
<ul>
    {% for plugin_version in subscriptions %}
    <li>
        <h3>
            <a href="/plugins/view/{{ plugin_version.id }}">
                {{ plugin_version.plugin.name }} v{{ plugin_version.major_version }}.{{ plugin_version.minor_version }}
            </a>
        </h3>
        <sub>
            {{ plugin_version.plugin.description }}
        </sub>
        <form action="/feed/unsubscribe/{{ plugin_version.id }}" method="post">
            {% csrf_token %}
            <button type="submit">Unsubscribe</button>
        </form>
    </li>
    {% endfor %}
</ul>
<h2>Updates</h2>
{% for old_version, new_version in updates %}
<li>
    <h3>
        {{ old_version.plugin.name }}
    </h3>
    <sub>
        {{ old_version.plugin.description }}
    </sub>
    <p>
        <a href="/plugins/view/{{ old_version.id }}">
            v{{ old_version.major_version }}.{{ old_version.minor_version }}
        </a>
        â†’
        <a href="/plugins/view/{{ new_version.id }}">
            v{{ new_version.major_version }}.{{ new_version.minor_version }}
        </a>
    </p>
    <form action="/feed/update/{{ new_version.id }}" method="post">
        {% csrf_token %}
        <button type="submit">Update</button>
    </form>
</li>
{% endfor %}
<ul id="main-feed">
</ul>
<script src="/static/feed/posts.js"></script>
<script>
    var postFetchers = []
</script>
{% for post_fetcher in post_fetchers %}
<script>
    var fetchPosts = function() {};
    /* beautify preserve:start */
    {{ post_fetcher|safe }}
    /* beautify preserve:end */
    if (fetchPosts) {
        postFetchers.push(fetchPosts);
    }
</script>
{% endfor %}
<script>
    var ul = document.getElementById("main-feed");
    var posts = getPostsHtml(postFetchers);
    for (var i = 0; i < posts.length; ++i) {
        ul.appendChild(posts[i]);
    }
</script>
{% endblock %}
